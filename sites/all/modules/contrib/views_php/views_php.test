<?php
/**
 * @file
 * views_php.test
 * This file contains the testing code for this module
 */

/**
 * The test case
 */
class ViewsPHPTestCase extends DrupalWebTestCase {
  /**
   * Info for this test case.
   */
  public static function getInfo() {
    return array(
      'name' => t('Views PHP: basic test'),
      'description' => t('Test Views PHP functionality.'),
      'group' => 'Views PHP',
    );
  }

  /*
   * Enable your module
   */
  public function setUp() {
    // set up a new site with default core modules, mymodule, and
    // dependencies.
    parent::setUp('views_php', 'views_ui');
  }

  /*
   * Test case for mymodule.
   */
  public function testModule() {
    $this->drupalLogin($this->drupalCreateUser(array('administer views')));
    $this->drupalCreateNode(array('type' => 'article'));
    $this->drupalCreateNode(array('type' => 'article'));
    $this->drupalCreateNode(array('type' => 'article'));
    $edit = array(
      'human_name' => 'view',
      'name' => 'view_with_phpcode',
      'page[items_per_page]' => 2,
      'page[path]' => 'path',
      'page[style][row_plugin]' => 'fields',
    );
    $this->drupalPost('admin/structure/views/add', $edit, 'Continue & edit');
    $edit = array(
      'name[views.php]' => 1,
    );
    $this->drupalPost('admin/structure/views/nojs/add-item/view_with_phpcode/page/field', $edit, 'Add and configure fields');
    $this->drupalPost(NULL, array(), 'Apply');
    $this->drupalPost(NULL, array(), 'Save');
    $this->drupalGet('path');
    $this->assertRaw('<ul class="pager">', 'A pager is present when PHP views is used for a field in views');
  }
}
